<view class="container">
  <!-- 个人信息卡片 -->
  <view class="profile-card card">
    <view class="profile-header">
      <view class="avatar">
        <text class="avatar-text">{{userInfo.name ? userInfo.name.charAt(0) : '用'}}</text>
      </view>
      <view class="profile-info">
        <text class="profile-name">{{userInfo.name || '未设置姓名'}}</text>
        <text class="profile-role">{{userInfo.role === 'elder' ? '长辈用户' : '家庭成员'}}</text>
        <text class="profile-phone">{{userInfo.phone || '未设置手机号'}}</text>
      </view>
      <button class="edit-btn" bindtap="showEditForm">编辑</button>
    </view>
  </view>

  <!-- 功能菜单 -->
  <view class="menu-section">
    <view class="menu-item" bindtap="goToFamilyBind">
      <view class="menu-icon">👨‍👩‍👧‍👦</view>
      <view class="menu-content">
        <text class="menu-title">家庭管理</text>
        <text class="menu-desc">绑定家庭成员，共同关注健康</text>
      </view>
      <text class="menu-arrow">></text>
    </view>
  </view>

  <!-- 紧急联系人 -->
  <view class="section card">
    <view class="section-header">
      <text class="section-title">紧急联系人</text>
      <button class="add-contact-btn" bindtap="showContactForm">添加</button>
    </view>
    
    <view class="contact-list" wx:if="{{emergencyContacts.length > 0}}">
      <view class="contact-item" wx:for="{{emergencyContacts}}" wx:key="id">
        <view class="contact-info">
          <text class="contact-name">{{item.name}}</text>
          <text class="contact-phone">{{item.phone}}</text>
          <text class="contact-relationship">{{item.relationship}}</text>
        </view>
        <button class="delete-contact-btn" bindtap="deleteContact" data-id="{{item.id}}">删除</button>
      </view>
    </view>
    
    <view class="empty-tip" wx:else>
      <text>暂无紧急联系人，点击"添加"按钮添加</text>
    </view>
  </view>

  <!-- 家庭成员 -->
  <view class="section card" wx:if="{{familyMembers.length > 0}}">
    <view class="section-header">
      <text class="section-title">家庭成员</text>
    </view>
    
    <view class="family-list">
      <view class="family-item" wx:for="{{familyMembers}}" wx:key="_id">
        <view class="family-avatar">
          <text>{{item.name ? item.name.charAt(0) : '家'}}</text>
        </view>
        <view class="family-info">
          <text class="family-name">{{item.name}}</text>
          <text class="family-role">{{item.role === 'elder' ? '长辈' : '家庭成员'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 退出登录 -->
  <button class="logout-btn" bindtap="logout">退出登录</button>
</view>

<!-- 编辑个人信息弹窗 -->
<view class="modal-mask" wx:if="{{showEditForm}}" bindtap="hideEditForm">
  <view class="modal-content" catchtap="">
    <view class="modal-title">编辑个人信息</view>
    
    <view class="form-group">
      <text class="form-label">姓名</text>
      <input class="form-input" 
             placeholder="请输入姓名" 
             value="{{editForm.name}}"
             data-field="name"
             bindinput="onEditInput"/>
    </view>
    
    <view class="form-group">
      <text class="form-label">手机号</text>
      <input class="form-input" 
             placeholder="请输入手机号" 
             value="{{editForm.phone}}"
             data-field="phone"
             bindinput="onEditInput"/>
    </view>
    
    <view class="modal-actions">
      <button class="cancel-btn" bindtap="hideEditForm">取消</button>
      <button class="confirm-btn" bindtap="saveUserInfo">保存</button>
    </view>
  </view>
</view>

<!-- 添加紧急联系人弹窗 -->
<view class="modal-mask" wx:if="{{showContactForm}}" bindtap="hideContactForm">
  <view class="modal-content" catchtap="">
    <view class="modal-title">添加紧急联系人</view>
    
    <view class="form-group">
      <text class="form-label">姓名</text>
      <input class="form-input" 
             placeholder="请输入联系人姓名" 
             value="{{contactForm.name}}"
             data-field="name"
             bindinput="onContactInput"/>
    </view>
    
    <view class="form-group">
      <text class="form-label">手机号</text>
      <input class="form-input" 
             placeholder="请输入手机号" 
             value="{{contactForm.phone}}"
             data-field="phone"
             bindinput="onContactInput"/>
    </view>
    
    <view class="form-group">
      <text class="form-label">关系</text>
      <input class="form-input" 
             placeholder="如：子女、配偶等" 
             value="{{contactForm.relationship}}"
             data-field="relationship"
             bindinput="onContactInput"/>
    </view>
    
    <view class="modal-actions">
      <button class="cancel-btn" bindtap="hideContactForm">取消</button>
      <button class="confirm-btn" bindtap="addEmergencyContact">添加</button>
    </view>
  </view>
</view> 