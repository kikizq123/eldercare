<!--index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æ¬¢è¿å¡ç‰‡ -->
  <view class="card welcome-card">
    <view class="welcome-content">
      <view class="welcome-text">
        <text class="greeting">{{greeting}}</text>
        <text class="username">{{userInfo.nickname || 'ç”¨æˆ·'}}</text>
      </view>
      <view class="welcome-date">
        <text>{{currentDate}}</text>
      </view>
    </view>
  </view>

  <!-- å¿«é€Ÿè®°å½•å¡ç‰‡ -->
  <view class="card quick-record-card">
    <view class="card-header">
      <text class="card-title">å¿«é€Ÿè®°å½•è¡€å‹</text>
      <view class="last-record" wx:if="{{lastRecord}}">
        <text class="last-record-text">ä¸Šæ¬¡è®°å½•: {{lastRecord.time}}</text>
      </view>
    </view>
    <view class="card-content">
      <view class="quick-record-form">
        <view class="bp-input-group">
          <view class="bp-input-item">
            <text class="bp-label">æ”¶ç¼©å‹</text>
            <input 
              class="bp-input" 
              type="number" 
              placeholder="120"
              value="{{systolic}}" 
              bindinput="onSystolicInput"
            />
            <text class="bp-unit">mmHg</text>
          </view>
          
          <view class="bp-separator">/</view>
          
          <view class="bp-input-item">
            <text class="bp-label">èˆ’å¼ å‹</text>
            <input 
              class="bp-input" 
              type="number" 
              placeholder="80"
              value="{{diastolic}}" 
              bindinput="onDiastolicInput"
            />
            <text class="bp-unit">mmHg</text>
          </view>
        </view>
        
        <button 
          class="btn btn-primary btn-large quick-save-btn" 
          bindtap="quickSave"
          disabled="{{!canSave}}"
        >
          {{saving ? 'ä¿å­˜ä¸­...' : 'ç«‹å³ä¿å­˜'}}
        </button>
      </view>
    </view>
  </view>

  <!-- è¡€å‹åˆ†çº§æç¤º -->
  <view class="card level-tip-card" wx:if="{{bpLevel}}">
    <view class="level-tip">
      <view class="level-indicator" style="background-color: {{bpLevel.color}}"></view>
      <view class="level-content">
        <text class="level-name">{{bpLevel.name}}</text>
        <text class="level-desc">{{bpLevel.description}}</text>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥ç»Ÿè®¡ -->
  <view class="card stats-card">
    <view class="card-header">
      <text class="card-title">ä»Šæ—¥æ¦‚å†µ</text>
      <text class="more-link" bindtap="goToStats">æŸ¥çœ‹æ›´å¤š ></text>
    </view>
    <view class="card-content">
      <view class="stats-grid">
        <view class="stats-item">
          <text class="stats-value">{{todayStats.records}}</text>
          <text class="stats-label">ä»Šæ—¥è®°å½•</text>
        </view>
        <view class="stats-item">
          <text class="stats-value">{{todayStats.avgSystolic || '--'}}</text>
          <text class="stats-label">å¹³å‡æ”¶ç¼©å‹</text>
        </view>
        <view class="stats-item">
          <text class="stats-value">{{todayStats.avgDiastolic || '--'}}</text>
          <text class="stats-label">å¹³å‡èˆ’å¼ å‹</text>
        </view>
        <view class="stats-item">
          <text class="stats-value">{{totalRecords}}</text>
          <text class="stats-label">æ€»è®°å½•æ•°</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘è®°å½• -->
  <view class="card recent-records-card" wx:if="{{recentRecords.length > 0}}">
    <view class="card-header">
      <text class="card-title">æœ€è¿‘è®°å½•</text>
      <text class="more-link" bindtap="goToList">æŸ¥çœ‹å…¨éƒ¨ ></text>
    </view>
    <view class="card-content">
      <view class="recent-records">
        <view 
          class="record-item" 
          wx:for="{{recentRecords}}" 
          wx:key="_id"
          bindtap="goToDetail"
          data-id="{{item._id}}"
        >
          <view class="record-time">{{item.timeStr}}</view>
          <view class="record-bp">
            <view class="bp-value">
              <text class="bp-systolic">{{item.systolic}}</text>
              <text class="bp-separator">/</text>
              <text class="bp-diastolic">{{item.diastolic}}</text>
              <text class="bp-unit">mmHg</text>
            </view>
          </view>
          <view class="record-level">
            <view class="bp-level bp-level-{{item.classification.level}}">
              {{item.classification.name}}
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{recentRecords.length === 0 && !loading}}">
    <view class="empty-icon">ğŸ“Š</view>
    <view class="empty-text">è¿˜æ²¡æœ‰è¡€å‹è®°å½•</view>
    <view class="empty-desc">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹è®°å½•æ‚¨çš„è¡€å‹æ•°æ®</view>
    <button class="btn btn-primary" bindtap="goToRecord">å¼€å§‹è®°å½•</button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>
</view>

<!-- æµ®åŠ¨è®°å½•æŒ‰é’® -->
<view class="fab" bindtap="goToRecord">
  <text class="fab-icon">+</text>
</view>